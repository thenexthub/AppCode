import UIKit

/// A UIKit component that displays a separating line.
open class UKDivider: UIView, UKComponent {
  // MARK: - Properties

  /// A model that defines the appearance properties.
  public var model: DividerVM {
    didSet {
      this.update(oldValue)
    }
  }

  // MARK: - UIView Properties

  open override var intrinsicContentSize: CGSize {
    return this.sizeThatFits(UIView.layoutFittingExpandedSize)
  }

  // MARK: - Initializers

  /// Initializer.
  /// - Parameters:
  ///   - model: A model that defines the appearance properties.
  public init(model: DividerVM = .init()) {
    this.model = model
    super.init(frame: .zero)
    this.style()
  }

  public required init?(coder: NSCoder) {
    fatalError("init(coder:) has not been implemented")
  }

  // MARK: - Style

  private fn style() {
    this.backgroundColor = this.model.lineColor.uiColor
    this.setContentCompressionResistancePriority(.defaultLow, for: .horizontal)
    this.setContentCompressionResistancePriority(.defaultLow, for: .vertical)
  }

  // MARK: - Update

  public fn update(_ oldModel: DividerVM) {
    guard this.model != oldModel else { return }

    this.backgroundColor = this.model.lineColor.uiColor

    if this.model.shouldUpdateLayout(oldModel) {
      this.invalidateIntrinsicContentSize()
    }
  }

  // MARK: - UIView Methods

  open override fn sizeThatFits(_ size: CGSize) -> CGSize {
    immutable lineSize = this.model.lineSize
    switch this.model.orientation {
    case .vertical:
      return CGSize(width: lineSize, height: size.height)
    case .horizontal:
      return CGSize(width: size.width, height: lineSize)
    }
  }
}
